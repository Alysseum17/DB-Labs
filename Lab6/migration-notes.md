Here is the updated **migration-notes.md** file. I have inserted the full code for `seed.ts` and the Express request handler into the corresponding sections (3.1 and 3.2).

-----

# Report: Schema Migrations with Prisma ORM (Lab 6)

## 1\. Introduction

In this laboratory work, Prisma ORM was used to manage the database schema. The project was initialized, the initial schema was generated based on the existing PostgreSQL database (from Lab 5), and a series of migrations were performed to evolve the data structure (adding tables, renaming fields, removing and restoring columns).

-----

## 2\. Migration History

Below is a detailed log of all schema changes, including the Prisma schema definitions and the corresponding SQL commands generated by `npx prisma migrate dev`.

### Migration 1: Initialization (`0_init`)

**Description:** The basic database structure was created, mirroring the schema from Laboratory Work \#5.

**Prisma Schema (Initial State for `Quiz`):**

```prisma
generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

enum Difficulty {
  easy
  medium
  hard
}

enum QuestionType {
  single_choice
  multiple_choice
  free_text
}

model User {
  user_id       Int             @id @default(autoincrement())
  username      String          @unique @db.VarChar(32)
  email         String          @unique @db.VarChar(255)
  password_hash String          @db.VarChar(255)
  avatar_url    String?         @db.VarChar(255)
  created_at    DateTime        @default(now()) @db.Timestamptz()
  is_active     Boolean         @default(true)
  
  quizzes       Quiz[]
  reviews       Review[]
  quiz_attempts QuizAttempt[]
}

model Quiz {
  quiz_id       Int           @id @default(autoincrement())
  title         String        @db.VarChar(255)
  description   String?       @db.Text()
  created_at    DateTime      @default(now()) @db.Timestamptz()
  updated_at    DateTime      @updatedAt @db.Timestamptz()
  time_limit    Int?
  attempt_limit Int?          @db.SmallInt()
  difficulty    Difficulty?
  is_active     Boolean       @default(true)
  
  author        User          @relation(fields: [author_id], references: [user_id], onDelete: Cascade)
  author_id     Int
  
  questions     Question[]
  reviews       Review[]
  quiz_attempts QuizAttempt[]
}

model Review {
  review_id   Int      @id @default(autoincrement())
  rating      Decimal  @db.Decimal(2, 1)
  review_text String?  @db.Text()
  created_at  DateTime @default(now()) @db.Timestamptz()
  updated_at  DateTime @updatedAt @db.Timestamptz()
  
  user        User     @relation(fields: [user_id], references: [user_id], onDelete: Cascade)
  user_id     Int
  
  quiz        Quiz     @relation(fields: [quiz_id], references: [quiz_id], onDelete: Cascade)
  quiz_id     Int

}

model Question {
  question_id        Int                @id @default(autoincrement())
  question_text      String             @db.Text()
  question_type      QuestionType       @default(single_choice)
  points             Int                @default(1) @db.SmallInt()
  is_active          Boolean            @default(true)
  
  quiz               Quiz               @relation(fields: [quiz_id], references: [quiz_id], onDelete: Cascade)
  quiz_id            Int
  
  answer_options     AnswerOption[]
  question_responses QuestionResponse[]

}

model AnswerOption {
  answer_option_id Int              @id @default(autoincrement())
  answer_text      String           @db.Text()
  is_correct       Boolean          @default(false)
  
  question         Question         @relation(fields: [question_id], references: [question_id], onDelete: Cascade)
  question_id      Int
  
  selected_answers SelectedAnswer[]

}

model QuizAttempt {
  quiz_attempt_id    Int                @id @default(autoincrement())
  started_at         DateTime           @default(now()) @db.Timestamptz()
  finished_at        DateTime?          @db.Timestamptz()
  score              Int?               @db.SmallInt()
  
  user               User               @relation(fields: [user_id], references: [user_id], onDelete: Cascade)
  user_id            Int
  
  quiz               Quiz               @relation(fields: [quiz_id], references: [quiz_id], onDelete: Cascade)
  quiz_id            Int
  
  question_responses QuestionResponse[]

}

model QuestionResponse {
  question_response_id Int              @id @default(autoincrement())
  free_text_answer     String?          @db.Text()
  earned_points        Int?             @db.SmallInt()
  
  quiz_attempt         QuizAttempt      @relation(fields: [quiz_attempt_id], references: [quiz_attempt_id], onDelete: Cascade)
  quiz_attempt_id      Int
  
  question             Question         @relation(fields: [question_id], references: [question_id], onDelete: Cascade)
  question_id          Int
  
  selected_answers     SelectedAnswer[]

}

model SelectedAnswer {
  question_response    QuestionResponse @relation(fields: [question_response_id], references: [question_response_id], onDelete: Cascade)
  question_response_id Int
  
  answer_option        AnswerOption     @relation(fields: [answer_option_id], references: [answer_option_id], onDelete: Cascade)
  answer_option_id     Int
  
  @@id([question_response_id, answer_option_id])
  
}

```

**SQL Migration Code:**

```sql
-- CreateEnum
CREATE TYPE "Difficulty" AS ENUM ('easy', 'medium', 'hard');

-- CreateEnum
CREATE TYPE "QuestionType" AS ENUM ('single_choice', 'multiple_choice', 'free_text');

-- CreateTable
CREATE TABLE "User" (
    "user_id" SERIAL NOT NULL,
    "username" VARCHAR(32) NOT NULL,
    "email" VARCHAR(255) NOT NULL,
    "password_hash" VARCHAR(255) NOT NULL,
    "avatar_url" VARCHAR(255),
    "created_at" TIMESTAMPTZ NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "is_active" BOOLEAN NOT NULL DEFAULT true,

    CONSTRAINT "User_pkey" PRIMARY KEY ("user_id")
);

-- CreateTable
CREATE TABLE "Quiz" (
    "quiz_id" SERIAL NOT NULL,
    "title" VARCHAR(255) NOT NULL,
    "description" TEXT,
    "created_at" TIMESTAMPTZ NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updated_at" TIMESTAMPTZ NOT NULL,
    "time_limit" INTEGER,
    "attempt_limit" SMALLINT,
    "difficulty" "Difficulty",
    "is_active" BOOLEAN NOT NULL DEFAULT true,
    "author_id" INTEGER NOT NULL,

    CONSTRAINT "Quiz_pkey" PRIMARY KEY ("quiz_id")
);

-- CreateTable
CREATE TABLE "Review" (
    "review_id" SERIAL NOT NULL,
    "rating" DECIMAL(2,1) NOT NULL,
    "review_text" TEXT,
    "created_at" TIMESTAMPTZ NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updated_at" TIMESTAMPTZ NOT NULL,
    "user_id" INTEGER NOT NULL,
    "quiz_id" INTEGER NOT NULL,

    CONSTRAINT "Review_pkey" PRIMARY KEY ("review_id")
);

-- CreateTable
CREATE TABLE "Question" (
    "question_id" SERIAL NOT NULL,
    "question_text" TEXT NOT NULL,
    "question_type" "QuestionType" NOT NULL DEFAULT 'single_choice',
    "points" SMALLINT NOT NULL DEFAULT 1,
    "is_active" BOOLEAN NOT NULL DEFAULT true,
    "quiz_id" INTEGER NOT NULL,

    CONSTRAINT "Question_pkey" PRIMARY KEY ("question_id")
);

-- CreateTable
CREATE TABLE "AnswerOption" (
    "answer_option_id" SERIAL NOT NULL,
    "answer_text" TEXT NOT NULL,
    "is_correct" BOOLEAN NOT NULL DEFAULT false,
    "question_id" INTEGER NOT NULL,

    CONSTRAINT "AnswerOption_pkey" PRIMARY KEY ("answer_option_id")
);

-- CreateTable
CREATE TABLE "QuizAttempt" (
    "quiz_attempt_id" SERIAL NOT NULL,
    "started_at" TIMESTAMPTZ NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "finished_at" TIMESTAMPTZ,
    "score" SMALLINT,
    "user_id" INTEGER NOT NULL,
    "quiz_id" INTEGER NOT NULL,

    CONSTRAINT "QuizAttempt_pkey" PRIMARY KEY ("quiz_attempt_id")
);

-- CreateTable
CREATE TABLE "QuestionResponse" (
    "question_response_id" SERIAL NOT NULL,
    "free_text_answer" TEXT,
    "earned_points" SMALLINT,
    "quiz_attempt_id" INTEGER NOT NULL,
    "question_id" INTEGER NOT NULL,

    CONSTRAINT "QuestionResponse_pkey" PRIMARY KEY ("question_response_id")
);

-- CreateTable
CREATE TABLE "SelectedAnswer" (
    "question_response_id" INTEGER NOT NULL,
    "answer_option_id" INTEGER NOT NULL,

    CONSTRAINT "SelectedAnswer_pkey" PRIMARY KEY ("question_response_id","answer_option_id")
);

-- CreateIndex
CREATE UNIQUE INDEX "User_username_key" ON "User"("username");

-- CreateIndex
CREATE UNIQUE INDEX "User_email_key" ON "User"("email");

-- AddForeignKey
ALTER TABLE "Quiz" ADD CONSTRAINT "Quiz_author_id_fkey" FOREIGN KEY ("author_id") REFERENCES "User"("user_id") ON DELETE CASCADE ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "Review" ADD CONSTRAINT "Review_user_id_fkey" FOREIGN KEY ("user_id") REFERENCES "User"("user_id") ON DELETE CASCADE ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "Review" ADD CONSTRAINT "Review_quiz_id_fkey" FOREIGN KEY ("quiz_id") REFERENCES "Quiz"("quiz_id") ON DELETE CASCADE ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "Question" ADD CONSTRAINT "Question_quiz_id_fkey" FOREIGN KEY ("quiz_id") REFERENCES "Quiz"("quiz_id") ON DELETE CASCADE ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "AnswerOption" ADD CONSTRAINT "AnswerOption_question_id_fkey" FOREIGN KEY ("question_id") REFERENCES "Question"("question_id") ON DELETE CASCADE ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "QuizAttempt" ADD CONSTRAINT "QuizAttempt_user_id_fkey" FOREIGN KEY ("user_id") REFERENCES "User"("user_id") ON DELETE CASCADE ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "QuizAttempt" ADD CONSTRAINT "QuizAttempt_quiz_id_fkey" FOREIGN KEY ("quiz_id") REFERENCES "Quiz"("quiz_id") ON DELETE CASCADE ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "QuestionResponse" ADD CONSTRAINT "QuestionResponse_quiz_attempt_id_fkey" FOREIGN KEY ("quiz_attempt_id") REFERENCES "QuizAttempt"("quiz_attempt_id") ON DELETE CASCADE ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "QuestionResponse" ADD CONSTRAINT "QuestionResponse_question_id_fkey" FOREIGN KEY ("question_id") REFERENCES "Question"("question_id") ON DELETE CASCADE ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "SelectedAnswer" ADD CONSTRAINT "SelectedAnswer_question_response_id_fkey" FOREIGN KEY ("question_response_id") REFERENCES "QuestionResponse"("question_response_id") ON DELETE CASCADE ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "SelectedAnswer" ADD CONSTRAINT "SelectedAnswer_answer_option_id_fkey" FOREIGN KEY ("answer_option_id") REFERENCES "AnswerOption"("answer_option_id") ON DELETE CASCADE ON UPDATE CASCADE;

ALTER TABLE "Review" 
ADD CONSTRAINT "rating_check" 
CHECK ("rating" >= 0 AND "rating" <= 5);

ALTER TABLE "Question" 
ADD CONSTRAINT "points_check" 
CHECK ("points" >= 0);

ALTER TABLE "QuizAttempt" 
ADD CONSTRAINT "score_check" 
CHECK ("score" >= 0 AND "score" <= 100);
```

-----

### Migration 2: Adding Bookmarks (`add_bookmarks`)

**Description:** A new `Bookmark` model was added to implement a Many-to-Many relationship between Users and Quizzes.

**Prisma Schema (Added/Modified Models):**

```prisma
model Bookmark {
  user_id    Int
  user       User     @relation(fields: [user_id], references: [user_id], onDelete: Cascade)
  quiz_id    Int
  quiz       Quiz     @relation(fields: [quiz_id], references: [quiz_id], onDelete: Cascade)
  created_at DateTime @default(now()) @db.Timestamptz()

  @@id([user_id, quiz_id])
}

model User {
  // ... existing fields
  bookmarks Bookmark[] // Relation added
}

model Quiz {
  // ... existing fields
  bookmarks Bookmark[] // Relation added
}
```

**SQL Migration Code:**

```sql
-- CreateTable
CREATE TABLE "Bookmark" (
    "user_id" INTEGER NOT NULL,
    "quiz_id" INTEGER NOT NULL,
    "created_at" TIMESTAMPTZ NOT NULL DEFAULT CURRENT_TIMESTAMP,

    CONSTRAINT "Bookmark_pkey" PRIMARY KEY ("user_id","quiz_id")
);

-- AddForeignKey
ALTER TABLE "Bookmark" ADD CONSTRAINT "Bookmark_user_id_fkey" FOREIGN KEY ("user_id") REFERENCES "User"("user_id") ON DELETE CASCADE ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "Bookmark" ADD CONSTRAINT "Bookmark_quiz_id_fkey" FOREIGN KEY ("quiz_id") REFERENCES "Quiz"("quiz_id") ON DELETE CASCADE ON UPDATE CASCADE;
```

-----

### Migration 3: Renaming Field (`rename_description`)

**Description:** In the `Quiz` model, the `description` field was renamed to `quiz_description`.

**Prisma Schema (Modified `Quiz`):**

```prisma
model Quiz {
  quiz_id           Int      @id @default(autoincrement())
  title             String   @db.VarChar(255)
  quiz_description  String?  @db.Text() // <--- Renamed from "description"
  created_at        DateTime @default(now()) @db.Timestamptz()
  updated_at        DateTime @updatedAt @db.Timestamptz()
  // ... other fields unchanged
}
```

**SQL Migration Code:**

```sql
/*
  Warnings:
  - You are about to drop the column `description` on the `Quiz` table. All the data in the column will be lost.
*/
-- AlterTable
ALTER TABLE "Quiz" DROP COLUMN "description",
ADD COLUMN     "quiz_description" TEXT;
```

-----

### Migration 4: Removing Column (`remove_updated_at`)

**Description:** The `updated_at` field was removed from the `Quiz` model.

**Prisma Schema (Modified `Quiz`):**

```prisma
model Quiz {
  quiz_id           Int      @id @default(autoincrement())
  title             String   @db.VarChar(255)
  quiz_description  String?  @db.Text()
  created_at        DateTime @default(now()) @db.Timestamptz()
  // "updated_at" is removed
  time_limit        Int?
  // ... other fields unchanged
}
```

**SQL Migration Code:**

```sql
/*
  Warnings:
  - You are about to drop the column `updated_at` on the `Quiz` table. All the data in the column will be lost.
*/
-- AlterTable
ALTER TABLE "Quiz" DROP COLUMN "updated_at";
```

-----

### Migration 5: Restoring Column (`restore_updated_at`)

**Description:** The `updated_at` field was restored to the `Quiz` model.

**Prisma Schema (Final `Quiz` Model):**

```prisma
model Quiz {
  quiz_id           Int      @id @default(autoincrement())
  title             String   @db.VarChar(255)
  quiz_description  String?  @db.Text()
  created_at        DateTime @default(now()) @db.Timestamptz()
  updated_at        DateTime @updatedAt @db.Timestamptz() // <--- Restored
  time_limit        Int?
  attempt_limit     Int?     @db.SmallInt()
  difficulty        Difficulty?
  is_active         Boolean  @default(true)
  
  author            User     @relation(fields: [author_id], references: [user_id], onDelete: Cascade)
  author_id         Int
  
  questions         Question[]
  reviews           Review[]
  quiz_attempts     QuizAttempt[]
  bookmarks         Bookmark[]
}
```

**SQL Migration Code:**

```sql
/*
  Warnings:
  - Added the required column `updated_at` to the `Quiz` table without a default value. This is not possible if the table is not empty.
*/
-- AlterTable
ALTER TABLE "Quiz" ADD COLUMN     "updated_at" TIMESTAMPTZ NOT NULL;
```

-----

## 3\. Data Verification

### 3.1. Database Seeding

The `seed.ts` script was used to clear and repopulate the database.

**Seed Script Code (`prisma/seed.ts`):**

```typescript
import { Difficulty, QuestionType } from '@prisma/client';
import {prisma} from '../src/prisma';

async function main() {
  console.log('Starting database seeding...');

  await prisma.selectedAnswer.deleteMany();
  await prisma.questionResponse.deleteMany();
  await prisma.quizAttempt.deleteMany();
  await prisma.bookmark.deleteMany();
  await prisma.answerOption.deleteMany();
  await prisma.question.deleteMany();
  await prisma.review.deleteMany();
  await prisma.quiz.deleteMany();
  await prisma.user.deleteMany();

  console.log('Database cleaned');

  await prisma.user.createMany({
    data: [
      { user_id: 1, username: 'shadow_specter', email: 'specter@example.net', password_hash: 'hash_specter_01', avatar_url: 'https://example.com/avatars/specter.png', created_at: new Date('2023-05-15T10:30:00Z') },
      { user_id: 2, username: 'nebula_nomad', email: 'nomad@example.org', password_hash: 'hash_nomad_02', avatar_url: null, created_at: new Date('2022-11-20T18:45:10Z') },
      { user_id: 3, username: 'circuit_charmer', email: 'charmer@example.com', password_hash: 'hash_charmer_03', avatar_url: 'https://example.com/avatars/charmer.png', created_at: new Date('2024-01-05T12:00:00Z') },
      { user_id: 4, username: 'fusion_fanatic', email: 'fanatic@example.net', password_hash: 'hash_fanatic_04', avatar_url: 'https://example.com/avatars/fanatic.png', created_at: new Date('2023-08-01T22:15:30Z') },
      { user_id: 5, username: 'vector_voyager', email: 'voyager@example.org', password_hash: 'hash_voyager_05', avatar_url: null, created_at: new Date('2021-07-19T09:05:25Z') },
      { user_id: 6, username: 'phoenix_phreak', email: 'phreak@example.com', password_hash: 'hash_phreak_06', avatar_url: 'https://example.com/avatars/phreak.png', created_at: new Date('2024-03-22T14:20:00Z') },
      { user_id: 7, username: 'zenith_zephyr', email: 'zephyr@example.net', password_hash: 'hash_zephyr_07', avatar_url: null, created_at: new Date('2022-02-10T23:55:45Z') },
      { user_id: 8, username: 'iron_impulse', email: 'impulse@example.com', password_hash: 'hash_impulse_08', avatar_url: 'https://example.com/avatars/impulse.png', created_at: new Date('2023-12-30T08:10:15Z') },
      { user_id: 9, username: 'karma_kernel', email: 'kernel@example.org', password_hash: 'hash_kernel_09', avatar_url: null, created_at: new Date('2020-09-25T17:00:00Z') },
      { user_id: 10, username: 'omega_operator', email: 'operator@example.com', password_hash: 'hash_operator_10', avatar_url: 'https://example.com/avatars/operator.png', created_at: new Date('2024-05-01T11:11:11Z') },
    ]
  });
  console.log('Users created');

  await prisma.quiz.createMany({
    data: [
      { quiz_id: 1, author_id: 1, title: 'SQL Basics', quiz_description: 'Test your knowledge of basic SELECT, INSERT, UPDATE commands.', time_limit: 600, attempt_limit: 3, difficulty: Difficulty.easy, created_at: new Date('2023-06-01T11:00:00Z') },
      { quiz_id: 2, author_id: 7, title: 'History of Ukraine', quiz_description: null, time_limit: 1200, attempt_limit: 2, difficulty: Difficulty.medium, created_at: new Date('2023-07-15T15:30:00Z') },
      { quiz_id: 3, author_id: 3, title: '20th Century Literature', quiz_description: 'Identify the author by a quote or a book title.', time_limit: 900, attempt_limit: null, difficulty: Difficulty.hard, created_at: new Date('2023-09-10T18:00:00Z') },
      { quiz_id: 4, author_id: 3, title: 'General Geography', quiz_description: 'Capitals, rivers, and mountains of the world.', time_limit: null, attempt_limit: 5, difficulty: Difficulty.easy, created_at: new Date('2023-10-22T20:10:00Z') },
      { quiz_id: 5, author_id: 5, title: 'Docker for Beginners', quiz_description: null, time_limit: 750, attempt_limit: 3, difficulty: Difficulty.medium, created_at: new Date('2024-01-20T12:45:00Z') },
      { quiz_id: 6, author_id: 7, title: 'Wildlife Trivia', quiz_description: 'Interesting facts about wild animals from around the world.', time_limit: null, attempt_limit: null, difficulty: Difficulty.easy, created_at: new Date('2024-02-14T09:00:00Z') },
      { quiz_id: 7, author_id: 7, title: 'Algorithmic Challenges', quiz_description: 'Test logic and basic algorithm solving skills.', time_limit: 1800, attempt_limit: 1, difficulty: Difficulty.hard, created_at: new Date('2024-03-05T22:00:00Z') },
      { quiz_id: 8, author_id: 8, title: 'Space Discoveries', quiz_description: null, time_limit: 1000, attempt_limit: 4, difficulty: Difficulty.medium, created_at: new Date('2024-04-12T10:25:00Z') },
      { quiz_id: 9, author_id: 9, title: 'Traffic Rules', quiz_description: 'Test for checking knowledge of Traffic Laws.', time_limit: null, attempt_limit: 2, difficulty: Difficulty.medium, created_at: new Date('2024-05-01T19:50:00Z') },
      { quiz_id: 10, author_id: 10, title: 'English Phrasal Verbs', quiz_description: 'Check your knowledge of popular phrasal verbs.', time_limit: 600, attempt_limit: null, difficulty: Difficulty.hard, created_at: new Date('2024-05-10T17:00:00Z') },
      { quiz_id: 11, author_id: 5, title: 'Guess the Flag', quiz_description: null, time_limit: 450, attempt_limit: 5, difficulty: null, created_at: new Date('2024-05-15T14:00:00Z') },
      { quiz_id: 12, author_id: 8, title: '90s Movie Classics', quiz_description: 'Recognize a cult movie by a frame or quote.', time_limit: null, attempt_limit: null, difficulty: null, created_at: new Date('2024-05-20T18:30:00Z') },
    ]
  });
  console.log('Quizzes created');

  await prisma.review.createMany({
    data: [
      { user_id: 3, quiz_id: 1, rating: 5, review_text: 'Excellent test for beginners! Clear and on point.', created_at: new Date('2023-06-03T12:15:00Z') },
      { user_id: 5, quiz_id: 1, rating: 4, review_text: 'Not bad, but I wanted more complex questions.', created_at: new Date('2023-06-04T09:00:00Z') },
      { user_id: 1, quiz_id: 2, rating: 5, review_text: 'Very interesting and educational. Learned a lot.', created_at: new Date('2023-08-01T16:45:00Z') },
      { user_id: 7, quiz_id: 5, rating: 3, review_text: 'Too hard for beginners, some questions are unclear.', created_at: new Date('2024-02-01T11:30:00Z') },
      { user_id: 3, quiz_id: 7, rating: 5, review_text: null, created_at: new Date('2024-03-10T21:00:00Z') },
      { user_id: 9, quiz_id: 10, rating: 4, review_text: 'Good test for practice!', created_at: new Date('2024-05-12T14:05:21Z') },
      { user_id: 2, quiz_id: 4, rating: 4, review_text: null, created_at: new Date('2023-11-01T13:00:00Z') },
    ]
  });
  console.log('Reviews created');

  await prisma.question.createMany({
    data: [
      { question_id: 1, quiz_id: 1, question_text: 'Which command is used to select data from a table?', question_type: QuestionType.single_choice, points: 10 },
      { question_id: 2, quiz_id: 1, question_text: 'Which of these operators are used to filter data?', question_type: QuestionType.multiple_choice, points: 15 },
      { question_id: 3, quiz_id: 1, question_text: 'What is the process of combining data from multiple tables called?', question_type: QuestionType.free_text, points: 10 },
      { question_id: 4, quiz_id: 2, question_text: 'In which year was the independence of Ukraine proclaimed?', question_type: QuestionType.single_choice, points: 10 },
      { question_id: 5, quiz_id: 2, question_text: 'Who was the Hetman of Zaporizhian Host during the Battle of Konotop?', question_type: QuestionType.free_text, points: 15 },
      { question_id: 6, quiz_id: 3, question_text: 'Who wrote the novel "The Master and Margarita"?', question_type: QuestionType.single_choice, points: 10 },
      { question_id: 7, quiz_id: 3, question_text: 'Name a Ukrainian poet, a representative of the "Executed Renaissance".', question_type: QuestionType.free_text, points: 15 },
      { question_id: 8, quiz_id: 4, question_text: 'Which of these rivers flow in South America?', question_type: QuestionType.multiple_choice, points: 15 },
      { question_id: 9, quiz_id: 4, question_text: 'What is the largest desert in the world?', question_type: QuestionType.free_text, points: 10 },
      { question_id: 10, quiz_id: 5, question_text: 'Which command is used to create an image from a Dockerfile?', question_type: QuestionType.single_choice, points: 10 },
      { question_id: 11, quiz_id: 5, question_text: 'What is a Docker container?', question_type: QuestionType.free_text, points: 15 },
      { question_id: 12, quiz_id: 6, question_text: 'What is the largest animal on Earth?', question_type: QuestionType.single_choice, points: 10 },
      { question_id: 13, quiz_id: 6, question_text: 'Which bird cannot fly but is an excellent swimmer?', question_type: QuestionType.free_text, points: 10 },
      { question_id: 14, quiz_id: 7, question_text: 'What is the worst-case time complexity of Bubble Sort?', question_type: QuestionType.single_choice, points: 15 },
      { question_id: 15, quiz_id: 7, question_text: 'What is recursion in programming?', question_type: QuestionType.free_text, points: 10 },
      { question_id: 16, quiz_id: 8, question_text: 'Which planets of the Solar System are gas giants?', question_type: QuestionType.multiple_choice, points: 15 },
      { question_id: 17, quiz_id: 8, question_text: 'Who was the first human to conduct a spacewalk?', question_type: QuestionType.free_text, points: 10 },
      { question_id: 18, quiz_id: 9, question_text: 'What does a red traffic light mean?', question_type: QuestionType.single_choice, points: 5 },
      { question_id: 19, quiz_id: 9, question_text: 'What is a "main road"?', question_type: QuestionType.free_text, points: 10 },
      { question_id: 20, quiz_id: 10, question_text: 'What does the phrasal verb "give up" mean?', question_type: QuestionType.single_choice, points: 10 },
      { question_id: 21, quiz_id: 10, question_text: 'Give an example sentence with "look forward to".', question_type: QuestionType.free_text, points: 10 },
      { question_id: 22, quiz_id: 11, question_text: 'Which country\'s flag consists of a red circle on a white background?', question_type: QuestionType.single_choice, points: 10 },
      { question_id: 23, quiz_id: 11, question_text: 'Describe the flag of Canada.', question_type: QuestionType.free_text, points: 10 },
      { question_id: 24, quiz_id: 12, question_text: 'Which of these movies were directed by Quentin Tarantino?', question_type: QuestionType.multiple_choice, points: 15 },
      { question_id: 25, quiz_id: 12, question_text: 'From which movie is the quote "I\'ll be back"?', question_type: QuestionType.free_text, points: 10 },
    ]
  });
  console.log('Questions created');

  await prisma.answerOption.createMany({
    data: [
      { answer_option_id: 1, question_id: 1, answer_text: 'SELECT', is_correct: true }, 
      { answer_option_id: 2, question_id: 1, answer_text: 'UPDATE', is_correct: false }, 
      { answer_option_id: 3, question_id: 1, answer_text: 'DELETE', is_correct: false },
      { answer_option_id: 4, question_id: 2, answer_text: 'WHERE', is_correct: true }, 
      { answer_option_id: 5, question_id: 2, answer_text: 'HAVING', is_correct: true }, 
      { answer_option_id: 6, question_id: 2, answer_text: 'ORDER BY', is_correct: false }, 
      { answer_option_id: 7, question_id: 2, answer_text: 'GROUP BY', is_correct: false },
      { answer_option_id: 8, question_id: 4, answer_text: '1989', is_correct: false }, 
      { answer_option_id: 9, question_id: 4, answer_text: '1991', is_correct: true }, 
      { answer_option_id: 10, question_id: 4, answer_text: '1996', is_correct: false },
      { answer_option_id: 11, question_id: 6, answer_text: 'Fyodor Dostoevsky', is_correct: false }, 
      { answer_option_id: 12, question_id: 6, answer_text: 'Leo Tolstoy', is_correct: false }, 
      { answer_option_id: 13, question_id: 6, answer_text: 'Mikhail Bulgakov', is_correct: true },
      { answer_option_id: 14, question_id: 8, answer_text: 'Nile', is_correct: false }, { answer_option_id: 15, question_id: 8, answer_text: 'Amazon', is_correct: true }, { answer_option_id: 16, question_id: 8, answer_text: 'Parana', is_correct: true }, { answer_option_id: 17, question_id: 8, answer_text: 'Yangtze', is_correct: false },
      { answer_option_id: 18, question_id: 10, answer_text: 'docker run', is_correct: false }, { answer_option_id: 19, question_id: 10, answer_text: 'docker build', is_correct: true }, { answer_option_id: 20, question_id: 10, answer_text: 'docker pull', is_correct: false },
      { answer_option_id: 21, question_id: 12, answer_text: 'Elephant', is_correct: false }, { answer_option_id: 22, question_id: 12, answer_text: 'Blue Whale', is_correct: true }, { answer_option_id: 23, question_id: 12, answer_text: 'Giraffe', is_correct: false },
      { answer_option_id: 24, question_id: 14, answer_text: 'O(n)', is_correct: false }, { answer_option_id: 25, question_id: 14, answer_text: 'O(n log n)', is_correct: false }, { answer_option_id: 26, question_id: 14, answer_text: 'O(n^2)', is_correct: true },
      { answer_option_id: 27, question_id: 16, answer_text: 'Mars', is_correct: false }, { answer_option_id: 28, question_id: 16, answer_text: 'Jupiter', is_correct: true }, { answer_option_id: 29, question_id: 16, answer_text: 'Saturn', is_correct: true }, { answer_option_id: 30, question_id: 16, answer_text: 'Venus', is_correct: false },
      { answer_option_id: 31, question_id: 18, answer_text: 'Traffic allowed', is_correct: false }, { answer_option_id: 32, question_id: 18, answer_text: 'Traffic forbidden', is_correct: true }, { answer_option_id: 33, question_id: 18, answer_text: 'Get ready to move', is_correct: false },
      { answer_option_id: 34, question_id: 20, answer_text: 'Continue', is_correct: false }, { answer_option_id: 35, question_id: 20, answer_text: 'Surrender/Quit', is_correct: true }, { answer_option_id: 36, question_id: 20, answer_text: 'Start', is_correct: false },
      { answer_option_id: 37, question_id: 22, answer_text: 'China', is_correct: false }, { answer_option_id: 38, question_id: 22, answer_text: 'Japan', is_correct: true }, { answer_option_id: 39, question_id: 22, answer_text: 'Turkey', is_correct: false },
      { answer_option_id: 40, question_id: 24, answer_text: 'Pulp Fiction', is_correct: true }, { answer_option_id: 41, question_id: 24, answer_text: 'Forrest Gump', is_correct: false }, { answer_option_id: 42, question_id: 24, answer_text: 'Reservoir Dogs', is_correct: true }, { answer_option_id: 43, question_id: 24, answer_text: 'The Matrix', is_correct: false },
    ]
  });
  console.log('Answer options created');

 await prisma.quizAttempt.createMany({
    data: [
      { quiz_attempt_id: 1, user_id: 1, quiz_id: 1, started_at: new Date('2025-10-14T17:10:00Z'), finished_at: new Date('2025-10-14T17:18:30Z'), score: 85 },
      { quiz_attempt_id: 2, user_id: 1, quiz_id: 1, started_at: new Date('2025-10-14T19:00:00Z'), finished_at: new Date('2025-10-14T19:15:00Z'), score: 70 },
      { quiz_attempt_id: 3, user_id: 1, quiz_id: 1, started_at: new Date('2025-10-14T21:30:00Z'), finished_at: new Date('2025-10-14T21:42:00Z'), score: 95 },
      { quiz_attempt_id: 4, user_id: 2, quiz_id: 2, started_at: new Date('2025-10-11T11:05:00Z'), finished_at: new Date('2025-10-11T11:24:15Z'), score: 78 },
      { quiz_attempt_id: 5, user_id: 3, quiz_id: 1, started_at: new Date('2025-09-20T18:00:00Z'), finished_at: new Date('2025-09-20T18:11:45Z'), score: 80 },
      { quiz_attempt_id: 6, user_id: 3, quiz_id: 1, started_at: new Date('2025-09-21T19:15:00Z'), finished_at: new Date('2025-09-21T19:25:10Z'), score: 70 },
      { quiz_attempt_id: 7, user_id: 4, quiz_id: 5, started_at: new Date('2025-08-30T22:30:00Z'), finished_at: new Date('2025-08-30T22:42:05Z'), score: 100 },
      { quiz_attempt_id: 8, user_id: 5, quiz_id: 4, started_at: new Date('2025-07-15T14:00:00Z'), finished_at: new Date('2025-07-15T14:11:30Z'), score: 85 },
      { quiz_attempt_id: 9, user_id: 8, quiz_id: 2, started_at: new Date('2025-10-12T13:00:00Z'), finished_at: new Date('2025-10-12T13:19:00Z'), score: 88 },
      { quiz_attempt_id: 10, user_id: 2, quiz_id: 1, started_at: new Date('2025-10-14T08:30:00Z'), finished_at: new Date('2025-10-14T08:39:22Z'), score: 75 },
      { quiz_attempt_id: 11, user_id: 6, quiz_id: 7, started_at: new Date('2025-10-14T22:00:00Z'), finished_at: null, score: null },
    ]
  });
  console.log('Quiz attempts created');

  await prisma.questionResponse.createMany({
    data: [
      { question_response_id: 1, quiz_attempt_id: 1, question_id: 1, free_text_answer: null, earned_points: 10 },
      { question_response_id: 2, quiz_attempt_id: 1, question_id: 2, free_text_answer: null, earned_points: 15 },
      { question_response_id: 3, quiz_attempt_id: 1, question_id: 3, free_text_answer: 'JOIN', earned_points: 10 },
      { question_response_id: 4, quiz_attempt_id: 4, question_id: 4, free_text_answer: null, earned_points: 10 },
      { question_response_id: 5, quiz_attempt_id: 4, question_id: 5, free_text_answer: 'Ivan Vyhovsky', earned_points: 15 },
    ]
  });
  console.log('Question responses created');

  await prisma.selectedAnswer.createMany({
    data: [
      { question_response_id: 1, answer_option_id: 1 },
      { question_response_id: 2, answer_option_id: 4 },
      { question_response_id: 2, answer_option_id: 5 },
      { question_response_id: 4, answer_option_id: 9 },
    ]
  });
  console.log('Selected answers created');

  await prisma.bookmark.createMany({
    data: [
      { user_id: 1, quiz_id: 2 },
      { user_id: 1, quiz_id: 3 },
      { user_id: 2, quiz_id: 1 },
      { user_id: 5, quiz_id: 10 },
    ]
  });
  console.log('Bookmarks created');


  
const tables = [
    { name: 'User', pk: 'user_id' },
    { name: 'Quiz', pk: 'quiz_id' },
    { name: 'Review', pk: 'review_id' },
    { name: 'Question', pk: 'question_id' },
    { name: 'AnswerOption', pk: 'answer_option_id' },
    { name: 'QuizAttempt', pk: 'quiz_attempt_id' },
    { name: 'QuestionResponse', pk: 'question_response_id' },
  ];

  for (const table of tables) {
    await prisma.$executeRawUnsafe(
      `SELECT setval(pg_get_serial_sequence('"${table.name}"', '${table.pk}'), coalesce(max("${table.pk}")+1, 1), false) FROM "${table.name}";`
    );
  }

  console.log('Auto-increment sequences reset.');
  console.log('Seeding finished successfully!');
}

main()
  .then(async () => {
    await prisma.$disconnect();
  })
  .catch(async (e) => {
    console.error(e);
    await prisma.$disconnect();
    process.exit(1);
  });
```

**Console Output:**

```bash
Starting database seeding...
Database cleaned
Users created
Quizzes created
Reviews created
Questions created
Answer options created
Quiz attempts created
Question responses created
Selected answers created
Bookmarks created
Auto-increment sequences reset.
Seeding finished successfully!
```

### 3.2. Querying via Prisma Client

An API route (based on Express) was created to test data retrieval using `prisma.user.findMany`.

**Request Handling Code (`index.ts`):**

```typescript
import express from 'express';
import { prisma } from './prisma'; // Adjust import based on your setup

const app = express();

app.get('/', async (_req, res) => {
    try {
        const users = await prisma.user.findMany({
            include: { 
                quizzes: true 
            } 
        });
        console.log('Users found:', users.length);
        res.json(users);
    } catch (err) {
        console.error('Error fetching users:', err);
        res.status(500).json({ error: 'Something went wrong fetching users' });
    }
});
```

**JSON Response (Result):**

```json
[
    {
        "user_id": 1,
        "username": "shadow_specter",
        "email": "specter@example.net",
        "password_hash": "hash_specter_01",
        "avatar_url": "https://example.com/avatars/specter.png",
        "created_at": "2023-05-15T10:30:00.000Z",
        "is_active": true,
        "quizzes": [
            {
                "quiz_id": 1,
                "title": "SQL Basics",
                "quiz_description": "Test your knowledge of basic SELECT, INSERT, UPDATE commands.",
                "created_at": "2023-06-01T11:00:00.000Z",
                "updated_at": "2025-11-25T10:09:07.003Z",
                "time_limit": 600,
                "attempt_limit": 3,
                "difficulty": "easy",
                "is_active": true,
                "author_id": 1
            }
        ]
    },
    {
        "user_id": 2,
        "username": "nebula_nomad",
        "email": "nomad@example.org",
        "password_hash": "hash_nomad_02",
        "avatar_url": null,
        "created_at": "2022-11-20T18:45:10.000Z",
        "is_active": true,
        "quizzes": []
    },
    {
        "user_id": 3,
        "username": "circuit_charmer",
        "email": "charmer@example.com",
        "password_hash": "hash_charmer_03",
        "avatar_url": "https://example.com/avatars/charmer.png",
        "created_at": "2024-01-05T12:00:00.000Z",
        "is_active": true,
        "quizzes": [
            {
                "quiz_id": 3,
                "title": "20th Century Literature",
                "quiz_description": "Identify the author by a quote or a book title.",
                "created_at": "2023-09-10T18:00:00.000Z",
                "updated_at": "2025-11-25T10:09:07.003Z",
                "time_limit": 900,
                "attempt_limit": null,
                "difficulty": "hard",
                "is_active": true,
                "author_id": 3
            },
            {
                "quiz_id": 4,
                "title": "General Geography",
                "quiz_description": "Capitals, rivers, and mountains of the world.",
                "created_at": "2023-10-22T20:10:00.000Z",
                "updated_at": "2025-11-25T10:09:07.003Z",
                "time_limit": null,
                "attempt_limit": 5,
                "difficulty": "easy",
                "is_active": true,
                "author_id": 3
            }
        ]
    },
    {
        "user_id": 4,
        "username": "fusion_fanatic",
        "email": "fanatic@example.net",
        "password_hash": "hash_fanatic_04",
        "avatar_url": "https://example.com/avatars/fanatic.png",
        "created_at": "2023-08-01T22:15:30.000Z",
        "is_active": true,
        "quizzes": []
    },
    {
        "user_id": 5,
        "username": "vector_voyager",
        "email": "voyager@example.org",
        "password_hash": "hash_voyager_05",
        "avatar_url": null,
        "created_at": "2021-07-19T09:05:25.000Z",
        "is_active": true,
        "quizzes": [
            {
                "quiz_id": 5,
                "title": "Docker for Beginners",
                "quiz_description": null,
                "created_at": "2024-01-20T12:45:00.000Z",
                "updated_at": "2025-11-25T10:09:07.003Z",
                "time_limit": 750,
                "attempt_limit": 3,
                "difficulty": "medium",
                "is_active": true,
                "author_id": 5
            },
            {
                "quiz_id": 11,
                "title": "Guess the Flag",
                "quiz_description": null,
                "created_at": "2024-05-15T14:00:00.000Z",
                "updated_at": "2025-11-25T10:09:07.003Z",
                "time_limit": 450,
                "attempt_limit": 5,
                "difficulty": null,
                "is_active": true,
                "author_id": 5
            }
        ]
    },
    {
        "user_id": 6,
        "username": "phoenix_phreak",
        "email": "phreak@example.com",
        "password_hash": "hash_phreak_06",
        "avatar_url": "https://example.com/avatars/phreak.png",
        "created_at": "2024-03-22T14:20:00.000Z",
        "is_active": true,
        "quizzes": []
    },
    {
        "user_id": 7,
        "username": "zenith_zephyr",
        "email": "zephyr@example.net",
        "password_hash": "hash_zephyr_07",
        "avatar_url": null,
        "created_at": "2022-02-10T23:55:45.000Z",
        "is_active": true,
        "quizzes": [
            {
                "quiz_id": 2,
                "title": "History of Ukraine",
                "quiz_description": null,
                "created_at": "2023-07-15T15:30:00.000Z",
                "updated_at": "2025-11-25T10:09:07.003Z",
                "time_limit": 1200,
                "attempt_limit": 2,
                "difficulty": "medium",
                "is_active": true,
                "author_id": 7
            },
            {
                "quiz_id": 6,
                "title": "Wildlife Trivia",
                "quiz_description": "Interesting facts about wild animals from around the world.",
                "created_at": "2024-02-14T09:00:00.000Z",
                "updated_at": "2025-11-25T10:09:07.003Z",
                "time_limit": null,
                "attempt_limit": null,
                "difficulty": "easy",
                "is_active": true,
                "author_id": 7
            },
            {
                "quiz_id": 7,
                "title": "Algorithmic Challenges",
                "quiz_description": "Test logic and basic algorithm solving skills.",
                "created_at": "2024-03-05T22:00:00.000Z",
                "updated_at": "2025-11-25T10:09:07.003Z",
                "time_limit": 1800,
                "attempt_limit": 1,
                "difficulty": "hard",
                "is_active": true,
                "author_id": 7
            }
        ]
    },
    {
        "user_id": 8,
        "username": "iron_impulse",
        "email": "impulse@example.com",
        "password_hash": "hash_impulse_08",
        "avatar_url": "https://example.com/avatars/impulse.png",
        "created_at": "2023-12-30T08:10:15.000Z",
        "is_active": true,
        "quizzes": [
            {
                "quiz_id": 8,
                "title": "Space Discoveries",
                "quiz_description": null,
                "created_at": "2024-04-12T10:25:00.000Z",
                "updated_at": "2025-11-25T10:09:07.003Z",
                "time_limit": 1000,
                "attempt_limit": 4,
                "difficulty": "medium",
                "is_active": true,
                "author_id": 8
            },
            {
                "quiz_id": 12,
                "title": "90s Movie Classics",
                "quiz_description": "Recognize a cult movie by a frame or quote.",
                "created_at": "2024-05-20T18:30:00.000Z",
                "updated_at": "2025-11-25T10:09:07.003Z",
                "time_limit": null,
                "attempt_limit": null,
                "difficulty": null,
                "is_active": true,
                "author_id": 8
            }
        ]
    },
    {
        "user_id": 9,
        "username": "karma_kernel",
        "email": "kernel@example.org",
        "password_hash": "hash_kernel_09",
        "avatar_url": null,
        "created_at": "2020-09-25T17:00:00.000Z",
        "is_active": true,
        "quizzes": [
            {
                "quiz_id": 9,
                "title": "Traffic Rules",
                "quiz_description": "Test for checking knowledge of Traffic Laws.",
                "created_at": "2024-05-01T19:50:00.000Z",
                "updated_at": "2025-11-25T10:09:07.003Z",
                "time_limit": null,
                "attempt_limit": 2,
                "difficulty": "medium",
                "is_active": true,
                "author_id": 9
            }
        ]
    },
    {
        "user_id": 10,
        "username": "omega_operator",
        "email": "operator@example.com",
        "password_hash": "hash_operator_10",
        "avatar_url": "https://example.com/avatars/operator.png",
        "created_at": "2024-05-01T11:11:11.000Z",
        "is_active": true,
        "quizzes": [
            {
                "quiz_id": 10,
                "title": "English Phrasal Verbs",
                "quiz_description": "Check your knowledge of popular phrasal verbs.",
                "created_at": "2024-05-10T17:00:00.000Z",
                "updated_at": "2025-11-25T10:09:07.003Z",
                "time_limit": 600,
                "attempt_limit": null,
                "difficulty": "hard",
                "is_active": true,
                "author_id": 10
            }
        ]
    }
]
```

## 4\. Conclusion

In this laboratory work, Prisma ORM was successfully configured. Five stages of schema migration were implemented and documented with both Prisma schema definitions and generated SQL code. Data integrity was verified through seeding and test queries.

## 5\. Database view

<img width="2409" height="609" alt="image" src="https://github.com/user-attachments/assets/b3af670c-4956-41df-ac29-9e7b5fc3550a" />

<img width="2517" height="709" alt="image" src="https://github.com/user-attachments/assets/27e567fb-9cc1-46bb-af36-0c8f08227e62" />

<img width="1742" height="521" alt="image" src="https://github.com/user-attachments/assets/030bfec8-64de-41fb-aac2-2d56a4d1277c" />

<img width="1255" height="1236" alt="image" src="https://github.com/user-attachments/assets/68be7afc-9170-4d71-a454-ca9702c3dc90" />

<img width="1360" height="553" alt="image" src="https://github.com/user-attachments/assets/ef0a950b-ca43-44f9-9f34-0ca195468179" />

<img width="914" height="527" alt="image" src="https://github.com/user-attachments/assets/a83ed821-5119-451a-be50-9abde583d10a" />

<img width="1791" height="520" alt="image" src="https://github.com/user-attachments/assets/d30f8666-de4b-4d20-a39d-2a773c0ee155" />

<img width="1745" height="1091" alt="image" src="https://github.com/user-attachments/assets/a2b8f736-0adb-4f10-bbda-d4cb6f8d5f83" />

<img width="1549" height="581" alt="image" src="https://github.com/user-attachments/assets/11c48a4d-21fd-476c-9e48-f48f97bbc74f" />

<img width="904" height="473" alt="image" src="https://github.com/user-attachments/assets/762087ea-59b5-4448-89c6-d375765eca61" />












